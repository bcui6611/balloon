<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:neo4j="http://www.springframework.org/schema/data/neo4j"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/data/neo4j http://www.springframework.org/schema/data/neo4j/spring-neo4j-3.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.2.xsd">

    <context:annotation-config />
    <context:component-scan base-package="org.balloon_project" />

    <!--################################################-->
    <!-- project beans -->
    <!--################################################-->
    <bean id="initListener" class="org.balloon_project.InitListener" lazy-init="false" init-method="contextInitialized" destroy-method="contextDestroyed"/>

    <bean id="indexing" class="org.balloon_project.overflight.task.indexing.Indexing" destroy-method="waitUntilFinished">
        <lookup-method name="createIndexingTask" bean="indexingTask" />
    </bean>
    <bean id="indexingTask" class="org.balloon_project.overflight.task.indexing.IndexingTask" scope="prototype"/>
    <bean id="indexingThreadPool" class="java.util.concurrent.Executors" factory-method="newFixedThreadPool">
        <constructor-arg value="60"/>
    </bean>

    <bean id="importerFileListener" class="org.balloon_project.overflight.task.importer.ImporterFileListener" init-method="start" lazy-init="false" />
    <bean id="importer" class="org.balloon_project.overflight.task.importer.Importer" destroy-method="waitUntilFinished">
        <lookup-method name="createImporterTask" bean="importerTask" />
    </bean>
    <bean id="importerTask" class="org.balloon_project.overflight.task.importer.ImporterTask" scope="prototype"/>
    <bean id="importerThreadPool" class="java.util.concurrent.Executors" factory-method="newSingleThreadExecutor" />


    <!--################################################-->
    <!-- neo4j Configuration -->
    <!--################################################-->
    <tx:annotation-driven mode="proxy"/>
    <neo4j:repositories base-package="org.balloon_project.overflight.repository" />
    <neo4j:config graphDatabaseService="graphDatabaseService" id="neo4jConfig" base-package="org.balloon_project.overflight.model"/>
    <bean id="graphDatabaseService" class="org.springframework.data.neo4j.rest.SpringRestGraphDatabase">
        <constructor-arg index="0" value="http://localhost:7474/db/data" />
    </bean>

    <!-- Use this post processor to translate any Exceptions thrown in @Repository annotated classes -->
    <!--<bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor"/>-->
</beans>